# V21.3 Problem Terms Analysis Report

## Executive Summary

Analysis of the v21.3 training data reveals a critical data coverage gap for five Korean terms that produce garbage outputs in the trained Neural Sparse Encoder model.

**Problem Terms:**
- 추천 (recommendation)
- 데이터베이스 (database)
- 증상 (symptom)
- 질환 (disease/disorder)
- 인슐린 (insulin)

## Data Files Analyzed

| File | Line Count | Description |
|------|------------|-------------|
| `filtered_synonym_pairs.jsonl` | 66,070 | Training synonym pairs after filtering |
| `train_triplets.jsonl` | 315,729 | Anchor-positive-negative triplets for training |
| `corpus_texts.jsonl` | 646,700 | Raw corpus documents |
| `raw_synonym_pairs.jsonl` | 75,732 | Unfiltered synonym pairs |
| `removed_synonym_pairs.jsonl` | 9,662 | Pairs removed by quality filters |

## Detailed Analysis

### 1. Filtered Synonym Pairs Coverage

| Term | Exact Match (source) | Exact Match (target) | Partial Match |
|------|---------------------|---------------------|---------------|
| 추천 | 0 | 0 | 2 |
| 데이터베이스 | 0 | 0 | 0 |
| 증상 | 0 | 0 | 6 |
| 질환 | 0 | 0 | 8 |
| 인슐린 | 0 | 0 | 0 |

**Key Finding:** All 5 terms have ZERO exact matches as source or target terms.

### 2. Training Triplets Analysis

| Term | Anchor (exact) | Anchor (partial) | Positive | Negative |
|------|---------------|-----------------|----------|----------|
| 추천 | 0 | 5 | 5 | 38 |
| 데이터베이스 | 0 | 0 | 0 | 3 |
| 증상 | 0 | 18 | 19 | 15 |
| 질환 | 0 | 17 | 18 | 80 |
| 인슐린 | 0 | 0 | 0 | 0 |

**Critical Issue:** The standalone base terms never appear as anchors. When they do appear, they are often used as **negatives**, which actively teaches the model to distinguish them from related concepts rather than learning their semantic meaning.

Example from triplets data:
```json
{"anchor": "임상증상", "positive": "임상검사", "negative": "증상", ...}
{"anchor": "임상증상", "positive": "임상시험", "negative": "증상", ...}
```

This triplet teaches: "증상 is NOT similar to 임상증상" - counterproductive!

### 3. Corpus Coverage

| Term | Document Count | Note |
|------|---------------|------|
| 추천 | 4,505 | Common usage, high frequency |
| 데이터베이스 | 868 | Technical term, moderate frequency |
| 증상 | 1,831 | Medical/general term, high frequency |
| 질환 | 1,484 | Medical term, high frequency |
| 인슐린 | 106 | Specialized medical term, low frequency |

**Observation:** All terms exist abundantly in the corpus but are NOT represented as training pairs.

### 4. Partial Match Examples

Terms appear only as components of compound words:

**추천:**
- 영화추천 (movie recommendation) <-> 영화선택 (movie selection)

**증상:**
- 임상증상 (clinical symptoms) <-> 임상 (clinical)
- 임상증상 <-> 임상검사 (clinical examination)
- 임상증상 <-> 임상시험 (clinical trial)

**질환:**
- 관상동맥질환 (coronary artery disease) <-> 관상동맥 (coronary artery)
- 기저질환 (underlying condition) <-> 기저부 (base part)
- 호흡기질환 (respiratory disease) <-> 호흡기관 (respiratory organs)

## Root Cause Analysis

The model produces garbage outputs for these terms because:

1. **No Explicit Training:** These terms were never explicitly trained as semantic anchor points with their synonyms.

2. **Compound Word Bias:** They only appear embedded within longer compound words. The model learns the compound semantics but not the base word semantics.

3. **Negative Training Effect:** When these terms appear as negatives in triplets, the model is taught to AVOID associating them with related concepts.

4. **Sparse Encoding Gap:** Without explicit training pairs, the sparse encoder cannot properly represent these common standalone terms. The model has no learned sparse representation for the base term itself.

## Recommendations

### Immediate Fix: Add Explicit Training Pairs

Create synonym pairs for each problem term:

```json
// 추천 (recommendation)
{"source": "추천", "target": "권장", "category": "synonym"}
{"source": "추천", "target": "권유", "category": "synonym"}
{"source": "추천", "target": "소개", "category": "synonym"}
{"source": "추천", "target": "제안", "category": "synonym"}

// 데이터베이스 (database)
{"source": "데이터베이스", "target": "DB", "category": "synonym"}
{"source": "데이터베이스", "target": "데이터뱅크", "category": "synonym"}
{"source": "데이터베이스", "target": "데이터저장소", "category": "synonym"}

// 증상 (symptom)
{"source": "증상", "target": "증세", "category": "synonym"}
{"source": "증상", "target": "징후", "category": "synonym"}
{"source": "증상", "target": "병증", "category": "synonym"}

// 질환 (disease)
{"source": "질환", "target": "질병", "category": "synonym"}
{"source": "질환", "target": "병", "category": "synonym"}
{"source": "질환", "target": "병증", "category": "synonym"}

// 인슐린 (insulin)
{"source": "인슐린", "target": "인슐린호르몬", "category": "synonym"}
{"source": "인슐린", "target": "췌장호르몬", "category": "synonym"}
```

### Systemic Fix: Improve Data Pipeline

1. **Base Term Extraction:** Before training, analyze compound words and ensure base terms also have explicit training pairs.

2. **Frequency-Based Sampling:** High-frequency corpus terms should be prioritized for synonym pair generation.

3. **Negative Filtering:** Avoid using semantically related base terms as negatives in triplets.

4. **Medical/Technical Vocabulary:** Create specialized vocabulary lists for domain-specific terms that need explicit training.

## Conclusion

The v21.3 training data has a systematic gap where common standalone Korean terms are only represented as parts of compound words. This leads to poor sparse encoding for base vocabulary items. The fix requires adding explicit synonym pairs for these terms to ensure proper semantic representation.

---

*Analysis Date: 2024-12-31*
*Data Version: v21.3_filtered_enhanced*
